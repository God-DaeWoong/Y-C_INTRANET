<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - Y&C Intranet</title>

    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f7fafc;
            min-height: 100vh;
        }

        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            color: #667eea;
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .btn-logout {
            padding: 8px 16px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-logout:hover {
            background: #e53e3e;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 16px;
        }

        .page-header {
            margin-bottom: 24px;
        }

        .page-header h2 {
            color: #2d3748;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-header p {
            color: #718096;
            font-size: 15px;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            background: #f7fafc;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 180px;
            padding: 16px 24px;
            background: transparent;
            border: none;
            font-size: 15px;
            font-weight: 600;
            color: #718096;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .tab.active {
            color: #667eea;
            background: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* ì•Œë¦¼ ë°°ì§€ */
        .notification-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 22px;
            height: 22px;
            padding: 0 6px;
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
            border-radius: 11px;
            font-size: 12px;
            font-weight: 700;
            line-height: 1;
        }

        .notification-badge.zero {
            display: none;
        }

        /* íƒ­ ì»¨í…ì¸  */
        .tab-content {
            display: none;
            padding: 32px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 48px;
            color: #718096;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 64px 24px;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
            color: #a0aec0;
        }

        /* íƒ­ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab-header h3 {
            font-size: 20px;
            color: #2d3748;
            font-weight: 600;
        }

        .tab-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 12px;
            color: white;
        }

        .stat-card.secondary {
            background: #c6f6d5;
            color: #22543d;
        }

        .stat-card.warning {
            background: #fed7d7;
            color: #742a2a;
        }

        .stat-card {
            cursor: pointer;
            transition: all 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-card:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-card.selected {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5);
        }

        /* ì¼ì •/íœ´ê°€ ê´€ë¦¬ ì¹´ë“œ ìƒ‰ìƒ */
        .stat-schedule-company {
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: white;
        }

        .stat-schedule-annual {
            background: linear-gradient(135deg, #5C6BC0 0%, #3F51B5 100%);
            color: white;
        }

        .stat-schedule-approval {
            background: linear-gradient(135deg, #7986CB 0%, #5C6BC0 100%);
            color: white;
        }

        .stat-schedule-company.selected {
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.5);
        }

        .stat-schedule-annual.selected {
            box-shadow: 0 0 0 3px rgba(92, 107, 192, 0.5);
        }

        .stat-schedule-approval.selected {
            box-shadow: 0 0 0 3px rgba(121, 134, 203, 0.5);
        }

        /* ì—°ì°¨ ìˆ˜ì¹˜ ìƒ‰ìƒ ìŠ¤íƒ€ì¼ */
        .leave-number {
            font-weight: 700;
            font-size: 15px;
        }

        .leave-total {
            color: #2d3748;
        }

        .leave-remaining {
            color: #38a169;
        }

        .leave-used {
            color: #e53e3e;
        }

        .leave-scheduled {
            color: #ed8936;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }

        .stat-value small {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.9;
        }

        /* ì‚¬ì› ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .member-actions {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 24px;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            flex: 1;
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-item label {
            font-size: 12px;
            font-weight: 600;
            color: #2d3748;
            margin: 0;
        }

        .filter-item select,
        .filter-item input {
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
            background: white;
            min-width: 150px;
        }

        .filter-item select:focus,
        .filter-item input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-item.search-item {
            flex: 1;
            min-width: 250px;
        }

        .filter-item.search-item input {
            width: 100%;
        }

        .btn-primary {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .member-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f7fafc;
        }

        th {
            padding: 16px;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #edf2f7;
            font-size: 14px;
            color: #4a5568;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background: #f7fafc;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-active {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-inactive {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-admin {
            background: #fef5e7;
            color: #744210;
        }

        .badge-approver {
            background: #e6f7ff;
            color: #003a8c;
        }

        .badge-user {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-sm {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 4px;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #667eea;
            color: white;
        }

        .btn-edit:hover {
            background: #5568d3;
        }

        .btn-deactivate {
            background: #f56565;
            color: white;
        }

        .btn-deactivate:hover {
            background: #e53e3e;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 50px auto;
            max-width: 900px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        /* 2ì—´ ë ˆì´ì•„ì›ƒì„ ìœ„í•œ form-grid */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-grid .form-group {
            margin-bottom: 0;
        }

        /* ì„¹ì…˜ í—¤ë” */
        .form-section-header {
            grid-column: 1 / -1;
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
            padding: 12px 0 8px 0;
            border-bottom: 2px solid #e2e8f0;
            margin-top: 20px;
        }

        .form-section-header:first-child {
            margin-top: 0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid #edf2f7;
        }

        .modal-header h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 600;
        }

        .close {
            color: #a0aec0;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close:hover {
            color: #2d3748;
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #2d3748;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #edf2f7;
        }

        .btn-secondary {
            padding: 10px 20px;
            background: #e2e8f0;
            color: #2d3748;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-history {
            padding: 6px 16px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-history:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        /* ì—°ì°¨ ì´ë ¥ íŒì—… ìŠ¤íƒ€ì¼ */
        #leaveHistoryContent table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        #leaveHistoryContent table th,
        #leaveHistoryContent table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }

        #leaveHistoryContent table th {
            background: #f7fafc;
            font-weight: 700;
            color: #2d3748;
        }

        #leaveHistoryContent table tbody tr:hover {
            background: #f7fafc;
        }

        .history-summary {
            padding: 16px;
            background: #f7fafc;
            border-radius: 8px;
            text-align: right;
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
        }

        .history-empty {
            padding: 64px 24px;
            text-align: center;
            color: #a0aec0;
        }

        .form-group small {
            color: #718096;
            font-size: 12px;
            margin-top: 4px;
            display: block;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 16px 8px;
            }

            .page-header h2 {
                font-size: 22px;
            }

            .tabs {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                min-width: 140px;
                padding: 14px 16px;
                font-size: 14px;
            }

            .tab-content {
                padding: 20px 16px;
            }

            .notification-badge {
                min-width: 20px;
                height: 20px;
                font-size: 11px;
            }

            .member-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                flex-direction: column;
                width: 100%;
            }

            .filter-item {
                width: 100%;
            }

            .filter-item select,
            .filter-item input {
                width: 100%;
                min-width: unset;
            }

            .member-table {
                overflow-x: auto;
            }

            table {
                min-width: 800px;
            }

            .modal-content {
                margin: 20px;
                max-width: calc(100% - 40px);
            }
        }

        /* ë²”ë¡€ (Legend) */
        .legend {
            display: flex;
            gap: 24px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            padding: 16px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .legend-item span {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
        }

        /* FullCalendar ìŠ¤íƒ€ì¼ (schedule-calendar.htmlê³¼ ë™ì¼) */
        .fc .fc-toolbar-title {
            font-size: 24px !important;
            font-weight: 700;
        }

        .fc .fc-daygrid-day-number {
            font-size: 14px;
            padding: 6px;
        }

        .fc .fc-col-header-cell-cushion {
            font-size: 14px;
            font-weight: 700;
            padding: 10px 4px;
        }

        .fc .fc-daygrid-day {
            min-height: 100px;
            border: 1px solid #e2e8f0 !important;
        }

        /* ë‹¬ë ¥ í•˜ë‹¨ border í‘œì‹œ */
        .fc .fc-scrollgrid {
            border-bottom-width: 1px !important;
        }

        .fc-theme-standard td:last-child {
            border-right-width: 1px !important;
        }

        .fc-theme-standard .fc-scrollgrid {
            border: 1px solid #e2e8f0 !important;
        }

        /* í† ìš”ì¼ ë‚ ì§œ ìŠ¤íƒ€ì¼ (íŒŒë€ìƒ‰) */
        .fc .fc-day-sat .fc-daygrid-day-number {
            color: #3b82f6 !important;
            font-weight: 700;
        }

        /* ì¼ìš”ì¼ ë‚ ì§œ ìŠ¤íƒ€ì¼ (ë¹¨ê°„ìƒ‰) */
        .fc .fc-day-sun .fc-daygrid-day-number {
            color: #ef4444 !important;
            font-weight: 700;
        }

        /* ê³µíœ´ì¼ ìŠ¤íƒ€ì¼ - schedule-calendar.htmlê³¼ ë™ì¼í•˜ê²Œ ë°°ê²½ìƒ‰ ì œê±° */

        .fc .fc-button {
            border-radius: 8px;
            font-weight: 700;
            text-transform: none;
            padding: 8px 16px;
            background: white;
            border: 2px solid #e2e8f0;
            color: #2d3748;
        }

        .fc .fc-button-primary:not(:disabled).fc-button-active {
            background-color: #667eea !important;
            border-color: #667eea !important;
            color: white !important;
            font-weight: 600 !important;
        }

        .fc .fc-button-primary:hover {
            background-color: #f0f0f0 !important;
            border-color: #e2e8f0 !important;
            color: #2d3748 !important;
        }

        .fc .fc-button-primary:focus {
            box-shadow: none !important;
        }

        .fc .fc-button:focus {
            box-shadow: none !important;
            outline: none !important;
        }

        .fc .fc-button-primary:not(:disabled):active {
            background-color: white !important;
            border-color: #e2e8f0 !important;
            color: #2d3748 !important;
        }

        .fc-event {
            border: none;
            border-radius: 6px;
            padding: 5px 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 13px;
            line-height: 1.4;
        }

        .fc-event-title {
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            white-space: nowrap !important;
            display: block !important;
            max-width: 100% !important;
        }

        .fc-daygrid-event-harness .fc-event,
        .fc-daygrid-event {
            overflow: hidden !important;
        }

        .fc-event-main {
            overflow: hidden !important;
        }

        .fc-event:hover .fc-event-title {
            overflow: visible;
            white-space: normal;
            word-break: break-word;
        }

        /* ì¼ì • íƒ€ì…ë³„ ìƒ‰ìƒ */
        .fc-event.event-vacation,
        .fc-event.event-vacation .fc-event-main,
        .fc-event.event-vacation .fc-event-title {
            background: #ec4899 !important;
            background-color: #ec4899 !important;
            border-color: #ec4899 !important;
            color: white !important;
        }

        .fc-event.event-half-day,
        .fc-event.event-half-day .fc-event-main,
        .fc-event.event-half-day .fc-event-title {
            background: #8b5cf6 !important;
            background-color: #8b5cf6 !important;
            border-color: #8b5cf6 !important;
            color: white !important;
        }

        .fc-event.event-business-trip,
        .fc-event.event-business-trip .fc-event-main,
        .fc-event.event-business-trip .fc-event-title {
            background: #3b82f6 !important;
            background-color: #3b82f6 !important;
            border-color: #3b82f6 !important;
            color: white !important;
        }

        /* ì‹œê°„ëŒ€ ì´ë²¤íŠ¸(timegrid)ì—ì„œë„ ë™ì¼í•œ ìƒ‰ìƒ ì ìš© */
        .fc-timegrid-event.event-vacation,
        .fc-timegrid-event.event-half-day,
        .fc-timegrid-event.event-business-trip {
            opacity: 1 !important;
        }

        .fc-timegrid-event.event-vacation .fc-event-main {
            background: #ec4899 !important;
            color: white !important;
        }

        .fc-timegrid-event.event-half-day .fc-event-main {
            background: #8b5cf6 !important;
            color: white !important;
        }

        .fc-timegrid-event.event-business-trip .fc-event-main {
            background: #3b82f6 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1 onclick="location.href='/intranet-main.html'">Y&C Intranet</h1>
        </div>
        <div class="header-right">
            <div class="user-avatar" id="userAvatar">A</div>
            <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>

    <div class="container">
        <div class="page-header">
            <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>
            <p>ì‹œìŠ¤í…œ ì „ë°˜ì˜ ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤</p>
        </div>

        <div class="tabs-container">
            <!-- íƒ­ ë©”ë‰´ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab(0)">
                    <span>ì¼ì •/íœ´ê°€</span>
                    <span class="notification-badge" id="scheduleNotification">0</span>
                </button>
                <button class="tab" onclick="switchTab(1)">
                    <span>ê²½ë¹„ë³´ê³ ì„œ</span>
                    <span class="notification-badge" id="expenseNotification">0</span>
                </button>
                <button class="tab" onclick="switchTab(2)">
                    <span>ì‚¬ì› ê´€ë¦¬</span>
                    <span class="notification-badge" id="memberNotification">0</span>
                </button>
            </div>

            <!-- íƒ­ 1: ì¼ì •/íœ´ê°€ -->
            <div class="tab-content active" id="scheduleTab">
                <div class="tab-header">
                    <h3>ì¼ì • ë° íœ´ê°€ ê´€ë¦¬</h3>
                </div>

                <div class="tab-stats">
                    <div class="stat-card stat-schedule-company" onclick="selectScheduleCard('company')" id="scheduleCardCompany">
                        <div class="stat-label">ì „ì‚¬ ì¼ì •</div>
						<div class="stat-value"><span id="companyScheduleCount">0</span> <small>ê±´ (í˜„ì¬)</small></div>
                    </div>
                    <div class="stat-card stat-schedule-annual" onclick="selectScheduleCard('annual')" id="scheduleCardAnnual">
                        <div class="stat-label">ì„ì§ì› ì—°ì°¨ í˜„í™©</div>
                        <div class="stat-value"><span id="annualLeaveCount">0</span> <small>ëª…</small></div>
                    </div>
                    <div class="stat-card stat-schedule-approval" onclick="selectScheduleCard('approval')" id="scheduleCardApproval">
                        <div class="stat-label">íœ´ê°€ ìŠ¹ì¸ ëª©ë¡</div>
                        <div class="stat-value"><span id="approvalLeaveCount">0</span> <small>ê±´</small></div>
                    </div>
                </div>

                <!-- í•„í„° (ì„ì§ì› ì—°ì°¨ í˜„í™© ì¹´ë“œ ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                <div class="member-actions" id="scheduleFilters" style="display: none;">
                    <div class="filter-group">
                        <div class="filter-item">
                            <label>ë³¸ë¶€</label>
                            <select id="scheduleFilterParentDept" onchange="onScheduleParentDeptChange()">
                                <option value="">ì „ì²´ ë³¸ë¶€</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>ë¶€ì„œ</label>
                            <select id="scheduleFilterChildDept" onchange="onScheduleChildDeptChange()">
                                <option value="">ì „ì²´ ë¶€ì„œ</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>êµ¬ì„±ì›</label>
                            <select id="scheduleFilterMember" onchange="filterScheduleData()">
                                <option value="">ì „ì²´ êµ¬ì„±ì›</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ë‹¬ë ¥ (ì „ì‚¬ ì¼ì • ì¹´ë“œ ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                <div id="scheduleCalendarContainer" style="display: none; margin-top: 24px;">
                    <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                        <div id="companyScheduleCalendar"></div>
                    </div>

                    <!-- ë²”ë¡€ -->
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ec4899;"></div>
                            <span>ì—°ì°¨</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #8b5cf6;"></div>
                            <span>ë°˜ì°¨</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6;"></div>
                            <span>ì¶œì¥</span>
                        </div>
                    </div>
                </div>

                <!-- í…Œì´ë¸” (ì„ì§ì› ì—°ì°¨ í˜„í™© ì¹´ë“œ ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                <div class="member-table" id="scheduleTableContainer" style="display: none;">
                    <div id="scheduleTableContent" class="loading">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 16px;">ë¡œë”© ì¤‘...</p>
                    </div>
                </div>
            </div>

            <!-- íƒ­ 2: ê²½ë¹„ë³´ê³ ì„œ -->
            <div class="tab-content" id="expenseTab">
                <div class="tab-header">
                    <h3>ê²½ë¹„ë³´ê³ ì„œ ê´€ë¦¬</h3>
                </div>

                <div class="tab-stats">
                    <div class="stat-card">
                        <div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</div>
                        <div class="stat-value"><span id="pendingExpenseCount">0</span> <small>ê±´</small></div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-label">ì´ë²ˆ ë‹¬ ì´ ê²½ë¹„</div>
                        <div class="stat-value"><span id="monthlyExpenseAmount">0</span> <small>ì›</small></div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">ì´ë²ˆ ë‹¬ ë³´ê³ ì„œ</div>
                        <div class="stat-value"><span id="monthlyExpenseCount">0</span> <small>ê±´</small></div>
                    </div>
                </div>

                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ’°</div>
                    <h3>ê²½ë¹„ë³´ê³ ì„œ ê´€ë¦¬ ê¸°ëŠ¥</h3>
                    <p>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ê²½ë¹„ë³´ê³ ì„œë¥¼ ê´€ë¦¬í•˜ê³ , ì „ì²´ ê²½ë¹„ ë‚´ì—­ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- íƒ­ 3: ì‚¬ì› ê´€ë¦¬ -->
            <div class="tab-content" id="memberTab">
                <div class="tab-header">
                    <h3>ì‚¬ì› ê´€ë¦¬</h3>
                </div>

                <div class="tab-stats">
                    <div class="stat-card" onclick="filterByStatus('all')" id="statAll">
                        <div class="stat-label">ì „ì²´ ì‚¬ì›</div>
                        <div class="stat-value"><span id="totalMemberCount">0</span> <small>ëª…</small></div>
                    </div>
                    <div class="stat-card secondary" onclick="filterByStatus('active')" id="statActive">
                        <div class="stat-label">í™œì„± ì‚¬ì›</div>
                        <div class="stat-value"><span id="activeMemberCount">0</span> <small>ëª…</small></div>
                    </div>
                    <div class="stat-card warning" onclick="filterByStatus('inactive')" id="statInactive">
                        <div class="stat-label">ë¹„í™œì„± ì‚¬ì›</div>
                        <div class="stat-value"><span id="inactiveMemberCount">0</span> <small>ëª…</small></div>
                    </div>
                </div>

                <!-- ì‚¬ì› ê´€ë¦¬ ì»¨í…ì¸  -->
                <div class="member-actions">
                    <div class="filter-group">
                        <div class="filter-item">
                            <label>ë³¸ë¶€</label>
                            <select id="filterParentDept" onchange="onParentDeptChange()">
                                <option value="">ì „ì²´ ë³¸ë¶€</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>ë¶€ì„œ</label>
                            <select id="filterChildDept" onchange="filterMembers()">
                                <option value="">ì „ì²´ íŒ€</option>
                            </select>
                        </div>
                        <div class="filter-item search-item">
                            <label>ê²€ìƒ‰</label>
                            <input type="text" id="searchInput" placeholder="ì´ë¦„, ì´ë©”ì¼, ë¶€ì„œë¡œ ê²€ìƒ‰..." onkeyup="filterMembers()">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="showAddMemberModal()">+ ì‚¬ì› ë“±ë¡</button>
                </div>

                <div class="member-table">
                    <div id="memberTableContent" class="loading">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 16px;">ë¡œë”© ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‚¬ì› ë“±ë¡ ëª¨ë‹¬ -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì‚¬ì› ë“±ë¡</h3>
                <span class="close" onclick="closeAddMemberModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addMemberForm" onsubmit="submitAddMember(event)">

                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="form-section-header">ê¸°ë³¸ ì •ë³´</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ì´ë¦„ <span style="color: #f56565;">*</span></label>
                            <input type="text" id="newName" required placeholder="í™ê¸¸ë™">
                        </div>
                        <div class="form-group">
                            <label>ì´ë©”ì¼ <span style="color: #f56565;">*</span></label>
                            <input type="email" id="newEmail" required placeholder="example@yncsmart.com">
                        </div>
                        <div class="form-group">
                            <label>ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" id="newPhone" placeholder="010-1234-5678">
                        </div>
                    </div>

                    <!-- ì¡°ì§/ì§ë¬´ ì •ë³´ -->
                    <div class="form-section-header">ì¡°ì§ ë° ì§ë¬´ ì •ë³´</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ë³¸ë¶€ <span style="color: #f56565;">*</span></label>
                            <select id="newDivisionId" required onchange="loadDepartmentsByDivision()">
                                <option value="">ë³¸ë¶€ ì„ íƒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ë¶€ì„œ <span style="color: #f56565;">*</span></label>
                            <select id="newDepartmentId" required disabled>
                                <option value="">ë¨¼ì € ë³¸ë¶€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì§ê¸‰ <span style="color: #f56565;">*</span></label>
                            <select id="newPosition" required>
                                <option value="">ì§ê¸‰ ì„ íƒ</option>
                                <option value="ë³¸ë¶€ì¥">ë³¸ë¶€ì¥</option>
                                <option value="ì—°êµ¬ì†Œì¥">ì—°êµ¬ì†Œì¥</option>
                                <option value="ì „ë¬¸ìœ„ì›">ì „ë¬¸ìœ„ì›</option>
                                <option value="Unitì¥">Unitì¥</option>
                                <option value="ë§¤ë‹ˆì €">ë§¤ë‹ˆì €</option>
                            </select>
                        </div>
                    </div>

                    <!-- ê³„ì •/ê¶Œí•œ ì •ë³´ -->
                    <div class="form-section-header">ê³„ì • ë° ê¶Œí•œ</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ë¹„ë°€ë²ˆí˜¸ <span style="color: #f56565;">*</span></label>
                            <input type="password" id="newPassword" required placeholder="ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                            <small style="color: #718096;">ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”</small>
                        </div>
                        <div class="form-group">
                            <label>ê¶Œí•œ <span style="color: #f56565;">*</span></label>
                            <select id="newRole" required>
                                <option value="USER" selected>ì¼ë°˜ ì‚¬ìš©ì</option>
                                <option value="APPROVER">ê²°ì¬ê¶Œì</option>
                                <option value="ADMIN">ê´€ë¦¬ì</option>
                            </select>
                            <small style="color: #718096;">USER: ê¸°ë³¸ ì‚¬ìš©ì / APPROVER: ê²°ì¬ ê°€ëŠ¥ / ADMIN: ê´€ë¦¬ì</small>
                        </div>
                    </div>

                    <!-- ê·¼ë¬´/ì—°ì°¨ ì •ë³´ -->
                    <div class="form-section-header">ê·¼ë¬´ ë° ì—°ì°¨ ì •ë³´</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ì…ì‚¬ì¼ <span style="color: #f56565;">*</span></label>
                            <input type="date" id="newHireDate" required max="9999-12-31">
                        </div>
                        <div class="form-group">
                            <label>ì—°ì°¨ ë¶€ì—¬ì¼ìˆ˜ <span style="color: #f56565;">*</span></label>
                            <input type="number" id="newAnnualLeave" value="15" min="0" max="30" step="0.5" required>
                            <small style="color: #718096;">ê¸°ë³¸ 15ì¼, í•„ìš”ì‹œ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥ (0~30ì¼)</small>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeAddMemberModal()">ì·¨ì†Œ</button>
                        <button type="submit" class="btn-primary">ë“±ë¡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ì‚¬ì› ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì‚¬ì› ì •ë³´ ìˆ˜ì •</h3>
                <span class="close" onclick="closeEditMemberModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editMemberForm" onsubmit="submitEditMember(event)">
                    <input type="hidden" id="editMemberId">

                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="form-section-header">ê¸°ë³¸ ì •ë³´</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ì´ë¦„ <span style="color: #f56565;">*</span></label>
                            <input type="text" id="editName" required placeholder="í™ê¸¸ë™" disabled style="background: #f7fafc; cursor: not-allowed;">
                            <small style="color: #718096;">ì´ë¦„ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</small>
                        </div>
                        <div class="form-group">
                            <label>ì´ë©”ì¼</label>
                            <input type="email" id="editEmail" disabled style="background: #f7fafc; cursor: not-allowed;">
                            <small style="color: #718096;">ì´ë©”ì¼ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</small>
                        </div>
                        <div class="form-group">
                            <label>ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" id="editPhone" placeholder="010-1234-5678">
                        </div>
                        <div class="form-group">
                            <label>ìƒíƒœ <span style="color: #f56565;">*</span></label>
                            <select id="editIsActive" required>
                                <option value="true">í™œì„± (ì¬ì§)</option>
                                <option value="false">ë¹„í™œì„± (í‡´ì‚¬)</option>
                            </select>
                        </div>
                    </div>

                    <!-- ì¡°ì§/ì§ë¬´ ì •ë³´ -->
                    <div class="form-section-header">ì¡°ì§ ë° ì§ë¬´ ì •ë³´</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ë³¸ë¶€ <span style="color: #f56565;">*</span></label>
                            <select id="editDivisionId" required onchange="loadDepartmentsByDivisionForEdit()">
                                <option value="">ë³¸ë¶€ ì„ íƒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ë¶€ì„œ <span style="color: #f56565;">*</span></label>
                            <select id="editDepartmentId" required>
                                <option value="">ë¨¼ì € ë³¸ë¶€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì§ê¸‰ <span style="color: #f56565;">*</span></label>
                            <select id="editPosition" required>
                                <option value="">ì§ê¸‰ ì„ íƒ</option>
                                <option value="ë³¸ë¶€ì¥">ë³¸ë¶€ì¥</option>
                                <option value="ì—°êµ¬ì†Œì¥">ì—°êµ¬ì†Œì¥</option>
                                <option value="ì „ë¬¸ìœ„ì›">ì „ë¬¸ìœ„ì›</option>
                                <option value="Unitì¥">Unitì¥</option>
                                <option value="ë§¤ë‹ˆì €">ë§¤ë‹ˆì €</option>
                            </select>
                        </div>
                    </div>

                    <!-- ê³„ì •/ê¶Œí•œ ì •ë³´ -->
                    <div class="form-section-header">ê³„ì • ë° ê¶Œí•œ</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ê¶Œí•œ <span style="color: #f56565;">*</span></label>
                            <select id="editRole" required>
                                <option value="USER">ì¼ë°˜ ì‚¬ìš©ì</option>
                                <option value="APPROVER">ê²°ì¬ê¶Œì</option>
                                <option value="ADMIN">ê´€ë¦¬ì</option>
                            </select>
                            <small style="color: #718096;">USER: ê¸°ë³¸ ì‚¬ìš©ì / APPROVER: ê²°ì¬ ê°€ëŠ¥ / ADMIN: ê´€ë¦¬ì</small>
                        </div>
                    </div>

                    <!-- ê·¼ë¬´/ì—°ì°¨ ì •ë³´ -->
                    <div class="form-section-header">ê·¼ë¬´ ë° ì—°ì°¨ ì •ë³´</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ì…ì‚¬ì¼ <span style="color: #f56565;">*</span></label>
                            <input type="date" id="editHireDate" required disabled max="9999-12-31" style="background: #f7fafc; cursor: not-allowed;">
                            <small style="color: #718096;">ì…ì‚¬ì¼ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</small>
                        </div>
                        <div class="form-group">
                            <label>ì—°ì°¨ ë¶€ì—¬ì¼ìˆ˜ <span style="color: #f56565;">*</span></label>
                            <input type="number" id="editAnnualLeave" value="15" min="0" max="30" step="0.5" required>
                            <small style="color: #718096;">ê´€ë¦¬ìê°€ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥ (0~30ì¼)</small>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeEditMemberModal()">ì·¨ì†Œ</button>
                        <button type="submit" class="btn-primary">ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ì—°ì°¨ ì´ë ¥ íŒì—… -->
    <div id="leaveHistoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì—°ì°¨ ì´ë ¥</h3>
                <span class="close" onclick="closeLeaveHistoryModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="leaveHistoryContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 16px;">ë¡œë”© ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allMembers = [];
        let departments = [];
        let currentStatusFilter = 'all'; // 'all', 'active', 'inactive'

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tabIndex) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            // ì„ íƒí•œ íƒ­ í™œì„±í™”
            tabs[tabIndex].classList.add('active');
            tabContents[tabIndex].classList.add('active');

            // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            if (tabIndex === 0) {
                // ì¼ì •/íœ´ê°€ íƒ­ - ìµœì´ˆ 1íšŒë§Œ ì´ˆê¸°í™”
                if (!scheduleTabInitialized) {
                    loadScheduleStats();
                    initScheduleTab();
                } else {
                    console.log('ì¼ì • íƒ­ ì´ë¯¸ ì´ˆê¸°í™”ë¨ - ìŠ¤í‚µ');
                }
            } else if (tabIndex === 1) {
                loadExpenseStats();
                // ê²½ë¹„ë³´ê³ ì„œ íƒ­ì˜ ìº˜ë¦°ë” ì´ˆê¸°í™” (í•œ ë²ˆë§Œ ì´ˆê¸°í™”)
                if (!calendar) {
                    initCalendar();
                }
            } else if (tabIndex === 2) {
                loadMemberStats();
                loadMembers();
                loadDepartmentsForFilter();
                // ì „ì²´ ì‚¬ì› ì„ íƒ ìƒíƒœë¡œ ì´ˆê¸°í™”
                filterByStatus('all');
            }
        }

        // ë¡œê·¸ì¸ ì²´í¬
        function checkLogin() {
            const user = sessionStorage.getItem('user');
            if (!user) {
                window.location.href = '/intranet-login.html';
                return null;
            }
            const userData = JSON.parse(user);
            // ADMIN ê¶Œí•œ ì²´í¬
            if (userData.role !== 'ADMIN') {
                alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤');
                window.location.href = '/intranet-main.html';
                return null;
            }
            return userData;
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo() {
            const user = checkLogin();
            if (!user) return;
            document.getElementById('userAvatar').textContent = user.name.charAt(0);
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                await fetch('/api/intranet/auth/logout', { method: 'POST' });
            } finally {
                sessionStorage.removeItem('user');
                window.location.href = '/intranet-login.html';
            }
        }

        // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
        function updateNotificationBadge(elementId, count) {
            const badge = document.getElementById(elementId);
            if (badge) {
                badge.textContent = count;
                if (count === 0) {
                    badge.classList.add('zero');
                } else {
                    badge.classList.remove('zero');
                }
            }
        }

        // ì¼ì •/íœ´ê°€ í†µê³„ ë¡œë“œ
        async function loadScheduleStats() {
            try {
                // TODO: API ì—°ë™
                // ì„ì‹œ ë°ì´í„°
                const pendingCount = 3;
                const monthlyCount = 45;
                const todayLeaveCount = 5;

                document.getElementById('pendingScheduleCount').textContent = pendingCount;
                document.getElementById('monthlyScheduleCount').textContent = monthlyCount;
                document.getElementById('todayLeaveCount').textContent = todayLeaveCount;
                updateNotificationBadge('scheduleNotification', pendingCount);
            } catch (error) {
                console.error('ì¼ì •/íœ´ê°€ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ê²½ë¹„ë³´ê³ ì„œ í†µê³„ ë¡œë“œ
        async function loadExpenseStats() {
            try {
                // TODO: API ì—°ë™
                // ì„ì‹œ ë°ì´í„°
                const pendingCount = 7;
                const monthlyAmount = 2450000;
                const monthlyCount = 12;

                document.getElementById('pendingExpenseCount').textContent = pendingCount;
                document.getElementById('monthlyExpenseAmount').textContent = monthlyAmount.toLocaleString('ko-KR');
                document.getElementById('monthlyExpenseCount').textContent = monthlyCount;
                updateNotificationBadge('expenseNotification', pendingCount);
            } catch (error) {
                console.error('ê²½ë¹„ë³´ê³ ì„œ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ì› í†µê³„ ë¡œë“œ
        async function loadMemberStats() {
            try {
                const response = await fetch('/api/intranet/members');
                const members = await response.json();

                if (members && Array.isArray(members)) {
                    const totalCount = members.length;
                    const activeCount = members.filter(m => m.isActive).length;
                    const inactiveCount = members.filter(m => !m.isActive).length;

                    document.getElementById('totalMemberCount').textContent = totalCount;
                    document.getElementById('activeMemberCount').textContent = activeCount;
                    document.getElementById('inactiveMemberCount').textContent = inactiveCount;
                    updateNotificationBadge('memberNotification', 0);
                }
            } catch (error) {
                console.error('ì‚¬ì› í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ì› ëª©ë¡ ë¡œë“œ
        async function loadMembers() {
            try {
                const response = await fetch('/api/intranet/members');
                const data = await response.json();

                allMembers = data || [];
                displayMembers(allMembers);

            } catch (error) {
                console.error('ì‚¬ì› ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
                document.getElementById('memberTableContent').innerHTML = `
                    <div class="empty-state">
                        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // ì‚¬ì› ëª©ë¡ í‘œì‹œ
        function displayMembers(members) {
            const container = document.getElementById('memberTableContent');

            if (!members || members.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>ë“±ë¡ëœ ì‚¬ì›ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            const roleText = (role) => {
                if (role === 'ADMIN') return 'ê´€ë¦¬ì';
                if (role === 'APPROVER') return 'ê²°ì¬ê¶Œì';
                return 'ì¼ë°˜';
            };

            const roleBadge = (role) => {
                if (role === 'ADMIN') return 'badge-admin';
                if (role === 'APPROVER') return 'badge-approver';
                return 'badge-user';
            };

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ì´ë¦„</th>
                            <th>ì´ë©”ì¼</th>
                            <th>ë¶€ì„œ</th>
                            <th>ì§ê¸‰</th>
                            <th>ê¶Œí•œ</th>
                            <th>ìƒíƒœ</th>
                            <th>ì…ì‚¬ì¼</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${members.map(member => `
                            <tr>
                                <td><strong>${member.name}</strong></td>
                                <td>${member.email}</td>
                                <td>${member.departmentName || '-'}</td>
                                <td>${member.position || '-'}</td>
                                <td>
                                    <span class="badge ${roleBadge(member.role)}">
                                        ${roleText(member.role)}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge ${member.isActive ? 'badge-active' : 'badge-inactive'}">
                                        ${member.isActive ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                    </span>
                                </td>
                                <td>${formatDate(member.hireDate)}</td>
                                <td>
                                    <button class="btn-sm btn-edit" onclick="editMember(${member.id})">ìˆ˜ì •</button>
                                    ${member.isActive ?
                                        `<button class="btn-sm btn-deactivate" onclick="deactivateMember(${member.id}, '${member.name}')">ë¹„í™œì„±í™”</button>`
                                        : ''
                                    }
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ë‚ ì§œ í¬ë§·
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR');
        }

        // ì—°ì°¨ ìë™ ê³„ì‚°
        function calculateAnnualLeave(mode) {
            const hireDateInput = mode === 'new' ? document.getElementById('newHireDate') : document.getElementById('editHireDate');
            const annualLeaveInput = mode === 'new' ? document.getElementById('newAnnualLeave') : document.getElementById('editAnnualLeave');
            const infoText = mode === 'new' ? document.getElementById('newAnnualLeaveInfo') : document.getElementById('editAnnualLeaveInfo');

            const hireDate = hireDateInput.value;
            if (!hireDate) {
                annualLeaveInput.value = 15;
                if (infoText) {
                    infoText.textContent = 'ì…ì‚¬ì¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤';
                }
                return;
            }

            // ì…ì‚¬ì¼ê³¼ í˜„ì¬ ë‚ ì§œ(1ì›” ê¸°ì¤€) ê³„ì‚°
            const hire = new Date(hireDate);
            const current = new Date();

            // ë…„ë„ ì°¨ì´ ê³„ì‚°
            let years = current.getFullYear() - hire.getFullYear();

            // ì›” ë¹„êµ (ì…ì‚¬ì›”ì´ í˜„ì¬ì›”ë³´ë‹¤ ëŠ¦ìœ¼ë©´ 1ë…„ ì°¨ê°)
            if (current.getMonth() < hire.getMonth()) {
                years--;
            } else if (current.getMonth() === hire.getMonth()) {
                // ê°™ì€ ì›”ì´ë©´ ì¼ ë¹„êµ
                if (current.getDate() < hire.getDate()) {
                    years--;
                }
            }

            // ì—°ì°¨ ê³„ì‚° ë¡œì§
            let annualDays = 15; // ê¸°ë³¸ 15ì¼
            let reason = 'ê¸°ë³¸';

            if (years >= 3) {
                // 3ë…„ ì´ìƒ: +1ì¼ (16ì¼)
                annualDays = 16;
                reason = '3ë…„ ê·¼ì†';

                // 3ë…„ ì´í›„ ë§¤ 2ë…„ë§ˆë‹¤ 1ì¼ ì¶”ê°€
                const additionalYears = years - 3;
                const additionalDays = Math.floor(additionalYears / 2);
                annualDays += additionalDays;

                if (additionalDays > 0) {
                    reason = `${years}ë…„ ê·¼ì†`;
                }
            }

            // ìµœëŒ€ 25ì¼ ì œí•œ
            if (annualDays > 25) {
                annualDays = 25;
                reason = 'ìµœëŒ€ í•œë„';
            }

            // ê°’ ì„¤ì •
            annualLeaveInput.value = annualDays;

            // ì•ˆë‚´ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            if (infoText) {
                infoText.textContent = `${annualDays}ì¼ (${reason} ê¸°ì¤€)`;
            }
        }

        // ìƒíƒœë³„ í•„í„°
        function filterByStatus(status) {
            currentStatusFilter = status;

            // ëª¨ë“  stat-cardì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('selected');
            });

            // ì„ íƒëœ ì¹´ë“œì— selected í´ë˜ìŠ¤ ì¶”ê°€
            if (status === 'all') {
                document.getElementById('statAll').classList.add('selected');
            } else if (status === 'active') {
                document.getElementById('statActive').classList.add('selected');
            } else if (status === 'inactive') {
                document.getElementById('statInactive').classList.add('selected');
            }

            filterMembers();
        }

        // ì‚¬ì› ê²€ìƒ‰ ë° í•„í„°
        function filterMembers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const parentDept = document.getElementById('filterParentDept').value;
            const childDept = document.getElementById('filterChildDept').value;

            let filtered = allMembers;

            // ìƒíƒœ í•„í„°
            if (currentStatusFilter === 'active') {
                filtered = filtered.filter(m => m.isActive);
            } else if (currentStatusFilter === 'inactive') {
                filtered = filtered.filter(m => !m.isActive);
            }

            // ë³¸ë¶€ í•„í„°
            if (parentDept) {
                const childDepts = departments.filter(d => d.parentId == parentDept);
                const childDeptIds = childDepts.map(d => d.id);
                filtered = filtered.filter(m => childDeptIds.includes(m.departmentId));
            }

            // íŒ€ í•„í„°
            if (childDept) {
                filtered = filtered.filter(m => m.departmentId == childDept);
            }

            // ê²€ìƒ‰ì–´ í•„í„°
            if (searchTerm) {
                filtered = filtered.filter(member =>
                    member.name.toLowerCase().includes(searchTerm) ||
                    member.email.toLowerCase().includes(searchTerm) ||
                    (member.departmentName && member.departmentName.toLowerCase().includes(searchTerm))
                );
            }

            displayMembers(filtered);
        }

        // ë³¸ë¶€ ì„ íƒ ë³€ê²½ ì‹œ
        function onParentDeptChange() {
            const parentId = document.getElementById('filterParentDept').value;
            const childSelect = document.getElementById('filterChildDept');

            // íŒ€ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
            childSelect.innerHTML = '<option value="">ì „ì²´ íŒ€</option>';

            if (parentId) {
                const childDepts = departments.filter(d => d.parentId == parentId);
                childDepts.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.id;
                    option.textContent = dept.name;
                    childSelect.appendChild(option);
                });
            }

            filterMembers();
        }

        // ë¶€ì„œ ëª©ë¡ ë¡œë“œ
        async function loadDepartmentsForFilter() {
            try {
                const rootResponse = await fetch('/api/intranet/departments/root');
                const rootData = await rootResponse.json();

                if (rootData.success && rootData.departments && rootData.departments.length > 0) {
                    const companyId = rootData.departments[0].id;

                    const allDeptsResponse = await fetch('/api/intranet/departments');
                    const allDeptsData = await allDeptsResponse.json();
                    departments = allDeptsData.departments || allDeptsData || [];

                    const divisionResponse = await fetch(`/api/intranet/departments/children/${companyId}`);
                    const divisionData = await divisionResponse.json();

                    const select = document.getElementById('filterParentDept');
                    if (divisionData.success && divisionData.departments) {
                        divisionData.departments.forEach(dept => {
                            const option = document.createElement('option');
                            option.value = dept.id;
                            option.textContent = dept.name;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('ë¶€ì„œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ì› ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
        function showAddMemberModal() {
            document.getElementById('addMemberModal').style.display = 'block';
            document.getElementById('addMemberForm').reset();

            // ë¶€ì„œ ì„ íƒ ì´ˆê¸°í™”
            document.getElementById('newDepartmentId').innerHTML = '<option value="">ë¨¼ì € ë³¸ë¶€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            document.getElementById('newDepartmentId').disabled = true;

            // ë³¸ë¶€ ëª©ë¡ ë¡œë“œ
            loadDivisions();
        }

        // ì‚¬ì› ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸°
        function closeAddMemberModal() {
            document.getElementById('addMemberModal').style.display = 'none';
        }

        // ë³¸ë¶€ ëª©ë¡ ë¡œë“œ
        async function loadDivisions() {
            try {
                const rootResponse = await fetch('/api/intranet/departments/root');
                const rootData = await rootResponse.json();

                const select = document.getElementById('newDivisionId');
                select.innerHTML = '<option value="">ë³¸ë¶€ ì„ íƒ</option>';

                if (rootData.success && rootData.departments && rootData.departments.length > 0) {
                    const companyId = rootData.departments[0].id;

                    const divisionResponse = await fetch(`/api/intranet/departments/children/${companyId}`);
                    const divisionData = await divisionResponse.json();

                    if (divisionData.success && divisionData.departments) {
                        divisionData.departments.forEach(dept => {
                            const option = document.createElement('option');
                            option.value = dept.id;
                            option.textContent = dept.name;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('ë³¸ë¶€ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì„ íƒí•œ ë³¸ë¶€ì˜ í•˜ìœ„ ë¶€ì„œ ë¡œë“œ
        async function loadDepartmentsByDivision() {
            const divisionId = document.getElementById('newDivisionId').value;
            const deptSelect = document.getElementById('newDepartmentId');

            if (!divisionId) {
                deptSelect.innerHTML = '<option value="">ë¨¼ì € ë³¸ë¶€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                deptSelect.disabled = true;
                return;
            }

            try {
                const response = await fetch(`/api/intranet/departments/children/${divisionId}`);
                const data = await response.json();

                deptSelect.innerHTML = '<option value="">ë¶€ì„œ ì„ íƒ</option>';
                deptSelect.disabled = false;

                if (data.success && data.departments && data.departments.length > 0) {
                    data.departments.forEach(dept => {
                        const option = document.createElement('option');
                        option.value = dept.id;
                        option.textContent = dept.name;
                        deptSelect.appendChild(option);
                    });
                } else {
                    deptSelect.innerHTML = '<option value="">í•˜ìœ„ ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤</option>';
                }
            } catch (error) {
                console.error('ë¶€ì„œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                deptSelect.innerHTML = '<option value="">ë¶€ì„œ ë¡œë“œ ì‹¤íŒ¨</option>';
            }
        }

        // ì‚¬ì› ë“±ë¡ ì œì¶œ
        async function submitAddMember(event) {
            event.preventDefault();

            const departmentId = document.getElementById('newDepartmentId').value;
            if (!departmentId || departmentId === '') {
                alert('ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }

            const memberData = {
                email: document.getElementById('newEmail').value,
                password: document.getElementById('newPassword').value,
                name: document.getElementById('newName').value,
                phone: document.getElementById('newPhone').value || null,
                departmentId: parseInt(departmentId),
                position: document.getElementById('newPosition').value,
                role: document.getElementById('newRole').value,
                hireDate: document.getElementById('newHireDate').value,
                annualLeaveGranted: parseFloat(document.getElementById('newAnnualLeave').value) || 15,
                isActive: true  // ì‹ ê·œ ë“±ë¡ì€ í•­ìƒ í™œì„± ìƒíƒœ
            };

            try {
                const response = await fetch('/api/intranet/members', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(memberData)
                });

                const data = await response.json();

                if (data.success) {
                    alert('ì‚¬ì›ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeAddMemberModal();
                    loadMembers();
                    loadMemberStats();
                } else {
                    alert(data.message || 'ì‚¬ì› ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ì‚¬ì› ë“±ë¡ ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì‚¬ì› ìˆ˜ì •
        async function editMember(memberId) {
            const member = allMembers.find(m => m.id === memberId);
            if (!member) {
                alert('ì‚¬ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            // ëª¨ë‹¬ í•„ë“œì— ë°ì´í„° ì„¤ì •
            document.getElementById('editMemberId').value = member.id;
            document.getElementById('editEmail').value = member.email;
            document.getElementById('editName').value = member.name;
            document.getElementById('editPhone').value = member.phone || '';
            document.getElementById('editPosition').value = member.position || '';
            document.getElementById('editRole').value = member.role;
            document.getElementById('editHireDate').value = member.hireDate;
            document.getElementById('editAnnualLeave').value = member.annualLeaveGranted || 15;
            document.getElementById('editIsActive').value = member.isActive ? 'true' : 'false';

            // ì—°ì°¨ ê³„ì‚° (ì…ì‚¬ì¼ ê¸°ì¤€)
            calculateAnnualLeave('edit');

            // ë³¸ë¶€/ë¶€ì„œ ë¡œë“œ
            await loadDivisionsForEdit();

            if (member.departmentId) {
                const deptResponse = await fetch(`/api/intranet/departments/${member.departmentId}`);
                const deptData = await deptResponse.json();

                if (deptData.success && deptData.department) {
                    const dept = deptData.department;

                    if (dept.parentId) {
                        document.getElementById('editDivisionId').value = dept.parentId;
                        await loadDepartmentsByDivisionForEdit();
                        document.getElementById('editDepartmentId').value = member.departmentId;
                    } else {
                        document.getElementById('editDivisionId').value = member.departmentId;
                        await loadDepartmentsByDivisionForEdit();
                    }
                }
            }

            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('editMemberModal').style.display = 'block';
        }

        // ì‚¬ì› ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditMemberModal() {
            document.getElementById('editMemberModal').style.display = 'none';
            document.getElementById('editMemberForm').reset();
        }

        // ë³¸ë¶€ ëª©ë¡ ë¡œë“œ (ìˆ˜ì •ìš©)
        async function loadDivisionsForEdit() {
            try {
                const rootResponse = await fetch('/api/intranet/departments/root');
                const rootData = await rootResponse.json();

                const select = document.getElementById('editDivisionId');
                select.innerHTML = '<option value="">ë³¸ë¶€ ì„ íƒ</option>';

                if (rootData.success && rootData.departments && rootData.departments.length > 0) {
                    const companyId = rootData.departments[0].id;

                    const divResponse = await fetch(`/api/intranet/departments/children/${companyId}`);
                    const divData = await divResponse.json();

                    if (divData.success && divData.departments) {
                        divData.departments.forEach(div => {
                            const option = document.createElement('option');
                            option.value = div.id;
                            option.textContent = div.name;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('ë³¸ë¶€ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ë¶€ì„œ ëª©ë¡ ë¡œë“œ (ìˆ˜ì •ìš©)
        async function loadDepartmentsByDivisionForEdit() {
            const divisionId = document.getElementById('editDivisionId').value;
            const deptSelect = document.getElementById('editDepartmentId');

            if (!divisionId) {
                deptSelect.innerHTML = '<option value="">ë¨¼ì € ë³¸ë¶€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                deptSelect.disabled = true;
                return;
            }

            try {
                const response = await fetch(`/api/intranet/departments/children/${divisionId}`);
                const data = await response.json();

                deptSelect.innerHTML = '<option value="">ë¶€ì„œ ì„ íƒ</option>';

                if (data.success && data.departments) {
                    data.departments.forEach(dept => {
                        const option = document.createElement('option');
                        option.value = dept.id;
                        option.textContent = dept.name;
                        deptSelect.appendChild(option);
                    });
                }

                deptSelect.disabled = false;
            } catch (error) {
                console.error('ë¶€ì„œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
                deptSelect.innerHTML = '<option value="">ë¶€ì„œ ì¡°íšŒ ì‹¤íŒ¨</option>';
                deptSelect.disabled = true;
            }
        }

        // ì‚¬ì› ìˆ˜ì • ì œì¶œ
        async function submitEditMember(event) {
            event.preventDefault();

            const memberId = document.getElementById('editMemberId').value;
            const memberData = {
                email: document.getElementById('editEmail').value,
                name: document.getElementById('editName').value,
                phone: document.getElementById('editPhone').value,
                departmentId: parseInt(document.getElementById('editDepartmentId').value),
                position: document.getElementById('editPosition').value,
                role: document.getElementById('editRole').value,
                hireDate: document.getElementById('editHireDate').value,
                annualLeaveGranted: parseFloat(document.getElementById('editAnnualLeave').value),
                isActive: document.getElementById('editIsActive').value === 'true'
            };

            try {
                const response = await fetch(`/api/intranet/members/${memberId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(memberData)
                });

                const data = await response.json();

                if (data.success) {
                    alert('ì‚¬ì› ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeEditMemberModal();
                    loadMembers();
                    loadMemberStats();
                } else {
                    alert(data.message || 'ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ì‚¬ì› ìˆ˜ì • ì‹¤íŒ¨:', error);
                alert('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }
        }

        // ì‚¬ì› ë¹„í™œì„±í™”
        async function deactivateMember(memberId, memberName) {
            if (!confirm(`${memberName} ì‚¬ì›ì„ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            try {
                const response = await fetch(`/api/intranet/members/${memberId}/deactivate`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    alert(data.message);
                    loadMembers();
                    loadMemberStats();
                } else {
                    alert(data.message || 'ë¹„í™œì„±í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ë¹„í™œì„±í™” ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }

        // ì „ì²´ ì•Œë¦¼ ë¡œë“œ
        async function loadAllNotifications() {
            await loadScheduleStats();
            await loadExpenseStats();
            await loadMemberStats();
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const addModal = document.getElementById('addMemberModal');
            const editModal = document.getElementById('editMemberModal');

            if (event.target === addModal) {
                closeAddMemberModal();
            }
            if (event.target === editModal) {
                closeEditMemberModal();
            }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        // ======================================
        // ì¼ì •/íœ´ê°€ íƒ­ ê´€ë ¨ í•¨ìˆ˜
        // ======================================
        let allSchedules = [];
        let scheduleDepartments = [];
        let scheduleTabInitialized = false;

        // ì¼ì •/íœ´ê°€ íƒ­ ì´ˆê¸°í™”
        // ì¼ì •/íœ´ê°€ ì¹´ë“œ ì„ íƒ ìƒíƒœ ê´€ë¦¬
        let selectedScheduleCard = 'company'; // ê¸°ë³¸ê°’: ì „ì‚¬ ì¼ì •

        // ì¹´ë“œ ì„ íƒ í•¨ìˆ˜
        // ì „ì‚¬ ì¼ì • ë‹¬ë ¥ ì¸ìŠ¤í„´ìŠ¤
        let companyCalendar = null;

        function selectScheduleCard(cardType) {
            selectedScheduleCard = cardType;

            // ëª¨ë“  ì¹´ë“œì˜ selected í´ë˜ìŠ¤ ì œê±°
            document.getElementById('scheduleCardCompany').classList.remove('selected');
            document.getElementById('scheduleCardAnnual').classList.remove('selected');
            document.getElementById('scheduleCardApproval').classList.remove('selected');

            // ì„ íƒëœ ì¹´ë“œì— selected í´ë˜ìŠ¤ ì¶”ê°€
            if (cardType === 'company') {
                document.getElementById('scheduleCardCompany').classList.add('selected');
            } else if (cardType === 'annual') {
                document.getElementById('scheduleCardAnnual').classList.add('selected');
            } else if (cardType === 'approval') {
                document.getElementById('scheduleCardApproval').classList.add('selected');
            }

            // í•„í„°, í…Œì´ë¸”, ë‹¬ë ¥ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
            const scheduleFilters = document.getElementById('scheduleFilters');
            const scheduleTableContainer = document.getElementById('scheduleTableContainer');
            const scheduleCalendarContainer = document.getElementById('scheduleCalendarContainer');

            if (cardType === 'annual') {
                // ì„ì§ì› ì—°ì°¨ í˜„í™© ì¹´ë“œ ì„ íƒ ì‹œ - í•„í„°ì™€ í…Œì´ë¸” ëª¨ë‘ í‘œì‹œ
                scheduleFilters.style.display = 'block';
                scheduleTableContainer.style.display = 'block';
                scheduleCalendarContainer.style.display = 'none';
                // ì—°ì°¨ í˜„í™© í…Œì´ë¸” ë¡œë“œ
                loadAnnualLeaveTable();
            } else if (cardType === 'company') {
                // ì „ì‚¬ ì¼ì • ì¹´ë“œ ì„ íƒ ì‹œ - í•„í„°ì™€ ë‹¬ë ¥ í‘œì‹œ
                scheduleFilters.style.display = 'block';
                scheduleTableContainer.style.display = 'none';
                scheduleCalendarContainer.style.display = 'block';
                // ì „ì‚¬ ì¼ì • ë‹¬ë ¥ ì´ˆê¸°í™” ë° ë¡œë“œ
                initCompanyScheduleCalendar();
            } else {
                // íœ´ê°€ ìŠ¹ì¸ ëª©ë¡ ì¹´ë“œ ì„ íƒ ì‹œ - ëª¨ë‘ ìˆ¨ê¹€
                scheduleFilters.style.display = 'none';
                scheduleTableContainer.style.display = 'none';
                scheduleCalendarContainer.style.display = 'none';
            }
        }

        async function initScheduleTab() {
            try {
                console.log('ì¼ì • íƒ­ ì´ˆê¸°í™” ì‹œì‘');
                // ìˆœì°¨ì ìœ¼ë¡œ ë°ì´í„° ë¡œë“œ
                await loadScheduleDepartmentsForFilter();
                await loadSchedules();
                await updateScheduleStats();

                // ì´ˆê¸° ì¹´ë“œ ì„ íƒ (ì „ì‚¬ ì¼ì •)
                selectScheduleCard('company');

                scheduleTabInitialized = true;
                console.log('ì¼ì • íƒ­ ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('ì¼ì •/íœ´ê°€ íƒ­ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // ë¶€ì„œ ëª©ë¡ ë¡œë“œ (ì¼ì • íƒ­ìš©)
        async function loadScheduleDepartmentsForFilter() {
            try {
                const rootResponse = await fetch('/api/intranet/departments/root');
                const rootData = await rootResponse.json();

                if (rootData.success && rootData.departments && rootData.departments.length > 0) {
                    const companyId = rootData.departments[0].id;

                    const allDeptsResponse = await fetch('/api/intranet/departments');
                    const allDeptsData = await allDeptsResponse.json();
                    scheduleDepartments = allDeptsData.departments || allDeptsData || [];

                    const divisionResponse = await fetch(`/api/intranet/departments/children/${companyId}`);
                    const divisionData = await divisionResponse.json();

                    const select = document.getElementById('scheduleFilterParentDept');
                    if (divisionData.success && divisionData.departments) {
                        divisionData.departments.forEach(dept => {
                            const option = document.createElement('option');
                            option.value = dept.id;
                            option.textContent = dept.name;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('ë¶€ì„œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // í•œêµ­ ê³µíœ´ì¼ ë°ì´í„° (2026ë…„ ê¸°ì¤€)
        function getKoreanHolidays(year) {
            const holidays = {
                2026: [
                    { date: '2026-01-01', name: 'ì‹ ì •' },
                    { date: '2026-02-16', name: 'ì„¤ë‚  ì „ë‚ ' },
                    { date: '2026-02-17', name: 'ì„¤ë‚ ' },
                    { date: '2026-02-18', name: 'ì„¤ë‚  ë‹¤ìŒë‚ ' },
                    { date: '2026-03-01', name: 'ì‚¼ì¼ì ˆ' },
                    { date: '2026-05-05', name: 'ì–´ë¦°ì´ë‚ ' },
                    { date: '2026-05-24', name: 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ' },
                    { date: '2026-06-06', name: 'í˜„ì¶©ì¼' },
                    { date: '2026-08-15', name: 'ê´‘ë³µì ˆ' },
                    { date: '2026-09-24', name: 'ì¶”ì„ ì „ë‚ ' },
                    { date: '2026-09-25', name: 'ì¶”ì„' },
                    { date: '2026-09-26', name: 'ì¶”ì„ ë‹¤ìŒë‚ ' },
                    { date: '2026-10-03', name: 'ê°œì²œì ˆ' },
                    { date: '2026-10-09', name: 'í•œê¸€ë‚ ' },
                    { date: '2026-12-25', name: 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤' }
                ],
                2025: [
                    { date: '2025-01-01', name: 'ì‹ ì •' },
                    { date: '2025-01-28', name: 'ì„¤ë‚  ì „ë‚ ' },
                    { date: '2025-01-29', name: 'ì„¤ë‚ ' },
                    { date: '2025-01-30', name: 'ì„¤ë‚  ë‹¤ìŒë‚ ' },
                    { date: '2025-03-01', name: 'ì‚¼ì¼ì ˆ' },
                    { date: '2025-05-05', name: 'ì–´ë¦°ì´ë‚ ' },
                    { date: '2025-05-06', name: 'ëŒ€ì²´ê³µíœ´ì¼' },
                    { date: '2025-06-06', name: 'í˜„ì¶©ì¼' },
                    { date: '2025-08-15', name: 'ê´‘ë³µì ˆ' },
                    { date: '2025-10-05', name: 'ì¶”ì„ ì „ë‚ ' },
                    { date: '2025-10-06', name: 'ì¶”ì„' },
                    { date: '2025-10-07', name: 'ì¶”ì„ ë‹¤ìŒë‚ ' },
                    { date: '2025-10-08', name: 'ëŒ€ì²´ê³µíœ´ì¼' },
                    { date: '2025-10-03', name: 'ê°œì²œì ˆ' },
                    { date: '2025-10-09', name: 'í•œê¸€ë‚ ' },
                    { date: '2025-12-25', name: 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤' }
                ]
            };
            return holidays[year] || [];
        }

        // ë‚ ì§œê°€ ê³µíœ´ì¼ì¸ì§€ í™•ì¸
        function isHoliday(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            const holidays = getKoreanHolidays(year);
            return holidays.find(h => h.date === dateStr);
        }

        // ì „ì‚¬ ì¼ì • ë‹¬ë ¥ ì´ˆê¸°í™”
        async function initCompanyScheduleCalendar() {
            if (companyCalendar) {
                companyCalendar.destroy();
            }

            const calendarEl = document.getElementById('companyScheduleCalendar');

            companyCalendar = new FullCalendar.Calendar(calendarEl, {
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: ''
                },
                buttonText: {
                    today: 'ì˜¤ëŠ˜'
                },
                initialView: 'dayGridMonth',
                height: 'auto',
                events: async function(info, successCallback, failureCallback) {
                    try {
                        const filteredEvents = await loadCompanyScheduleEvents();
                        successCallback(filteredEvents);
                    } catch (error) {
                        console.error('ì¼ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                        failureCallback(error);
                    }
                },
                eventContent: function(arg) {
                    return { html: `<div style="padding: 2px 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: white !important;">${arg.event.title}</div>` };
                },
                eventDidMount: function(info) {
                    // ì´ë²¤íŠ¸ ì—˜ë¦¬ë¨¼íŠ¸ì— ì§ì ‘ ìŠ¤íƒ€ì¼ ì ìš©í•˜ì—¬ í™•ì‹¤í•˜ê²Œ ìƒ‰ìƒ í†µì¼
                    const scheduleType = info.event.extendedProps.scheduleType;
                    let bgColor = '';

                    if (scheduleType === 'VACATION') {
                        bgColor = '#ec4899';
                    } else if (scheduleType === 'HALF_DAY') {
                        bgColor = '#8b5cf6';
                    } else if (scheduleType === 'BUSINESS_TRIP') {
                        bgColor = '#3b82f6';
                    }

                    if (bgColor) {
                        info.el.style.backgroundColor = bgColor;
                        info.el.style.borderColor = bgColor;
                        info.el.style.color = 'white';

                        // ë‚´ë¶€ í…ìŠ¤íŠ¸ ìš”ì†Œë„ í°ìƒ‰ìœ¼ë¡œ
                        const titleEl = info.el.querySelector('.fc-event-title');
                        if (titleEl) {
                            titleEl.style.color = 'white';
                        }
                    }
                },
                dayCellDidMount: function(info) {
                    const date = info.date;
                    const holiday = isHoliday(date);
                    const dayNumber = info.el.querySelector('.fc-daygrid-day-number');
                    const dayTop = info.el.querySelector('.fc-daygrid-day-top');

                    if (dayNumber) {
                        // ê³µíœ´ì¼ (ë¹¨ê°„ìƒ‰)
                        if (holiday) {
                            dayNumber.style.color = '#e53e3e';
                            dayNumber.style.fontWeight = '700';

                            // ê³µíœ´ì¼ ì´ë¦„ í‘œì‹œ (ë‚ ì§œ ë²ˆí˜¸ ì™¼ìª½ì—)
                            if (dayTop) {
                                const holidayLabel = document.createElement('span');
                                holidayLabel.textContent = holiday.name;
                                holidayLabel.style.cssText = 'color: #e53e3e; font-size: 11px; font-weight: 600; margin-right: 6px;';
                                dayTop.insertBefore(holidayLabel, dayNumber);
                            }
                        }
                    }
                },
                displayEventTime: false,
                displayEventEnd: false
            });

            companyCalendar.render();
        }

        // ì „ì‚¬ ì¼ì • ì´ë²¤íŠ¸ ë¡œë“œ (í•„í„° ì ìš©)
        async function loadCompanyScheduleEvents() {
            try {
                // ì¼ì • ë° êµ¬ì„±ì› ë°ì´í„° ë¡œë“œ
                const [schedulesResponse, membersResponse] = await Promise.all([
                    fetch('/api/intranet/schedules'),
                    fetch('/api/intranet/members')
                ]);

                const schedulesData = await schedulesResponse.json();
                const membersData = await membersResponse.json();

                const schedules = Array.isArray(schedulesData) ? schedulesData : (schedulesData.schedules || []);
                const members = membersData.members || membersData || [];

                // í™œì„±í™”ëœ êµ¬ì„±ì› ID ëª©ë¡
                const activeMemberIds = members.filter(m => m.isActive).map(m => String(m.id));

                // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
                const parentDept = document.getElementById('scheduleFilterParentDept')?.value || '';
                const childDept = document.getElementById('scheduleFilterChildDept')?.value || '';
                const memberId = document.getElementById('scheduleFilterMember')?.value || '';

                // ì¼ì • í•„í„°ë§
                let filteredSchedules = schedules.filter(s => {
                    // íšŒì˜(MEETING) ì œì™¸
                    if (s.scheduleType === 'MEETING') return false;

                    // ë¹„í™œì„± ì‚¬ì› ì œì™¸
                    if (!activeMemberIds.includes(String(s.memberId))) return false;

                    // ìŠ¹ì¸ëœ ì¼ì • ë° ì˜ˆì•½ëœ ì¼ì • í‘œì‹œ (APPROVED, RESERVED)
                    return s.status === 'APPROVED' || s.status === 'RESERVED';
                });

                // ë¶€ì„œ í•„í„° ì ìš©
                if (memberId) {
                    filteredSchedules = filteredSchedules.filter(s => String(s.memberId) === String(memberId));
                } else if (childDept) {
                    const deptMembers = members.filter(m => String(m.departmentId) === String(childDept));
                    const deptMemberIds = deptMembers.map(m => String(m.id));
                    filteredSchedules = filteredSchedules.filter(s => deptMemberIds.includes(String(s.memberId)));
                } else if (parentDept) {
                    const childDepts = scheduleDepartments.filter(d => String(d.parentId) === String(parentDept));
                    const childDeptIds = childDepts.map(d => String(d.id));
                    const divisionMembers = members.filter(m => childDeptIds.includes(String(m.departmentId)));
                    const divisionMemberIds = divisionMembers.map(m => String(m.id));
                    filteredSchedules = filteredSchedules.filter(s => divisionMemberIds.includes(String(s.memberId)));
                }

                // FullCalendar ì´ë²¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const events = filteredSchedules.map(schedule => {
                    const member = members.find(m => String(m.id) === String(schedule.memberId));
                    const memberName = member ? member.name : '';

                    let typeLabel = '';
                    let color = '';
                    let className = '';

                    switch (schedule.scheduleType) {
                        case 'VACATION':
                            typeLabel = 'ì—°ì°¨';
                            color = '#ec4899';
                            className = 'event-vacation';
                            break;
                        case 'HALF_DAY':
                            typeLabel = 'ë°˜ì°¨';
                            color = '#8b5cf6';
                            className = 'event-half-day';
                            break;
                        case 'BUSINESS_TRIP':
                            typeLabel = 'ì¶œì¥';
                            color = '#3b82f6';
                            className = 'event-business-trip';
                            break;
                        default:
                            typeLabel = schedule.scheduleType;
                            color = '#6b7280';
                            className = 'event-default';
                    }

                    // ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
                    const formatDate = (dateValue) => {
                        if (!dateValue) return null;
                        // ì´ë¯¸ ë¬¸ìì—´ í˜•ì‹ì¸ ê²½ìš° (YYYY-MM-DD)
                        if (typeof dateValue === 'string' && dateValue.match(/^\d{4}-\d{2}-\d{2}/)) {
                            return dateValue.split('T')[0];
                        }
                        // Date ê°ì²´ë‚˜ íƒ€ì„ìŠ¤íƒ¬í”„ì¸ ê²½ìš°
                        const d = new Date(dateValue);
                        return d.toISOString().split('T')[0];
                    };

                    const startDateStr = formatDate(schedule.startDate);
                    const endDateStr = formatDate(schedule.endDate);

                    const event = {
                        id: schedule.id,
                        title: `${typeLabel} ${memberName}`,
                        allDay: !schedule.startTime, // ì‹œê°„ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì¢…ì¼ ì´ë²¤íŠ¸
                        backgroundColor: color,
                        borderColor: color,
                        className: className,
                        extendedProps: {
                            scheduleType: schedule.scheduleType,
                            memberName: memberName,
                            status: schedule.status,
                            startTime: schedule.startTime,
                            endTime: schedule.endTime
                        }
                    };

                    // ì‹œì‘ì¼/ì¢…ë£Œì¼ ì„¤ì •
                    if (schedule.startTime && schedule.endTime) {
                        // ì‹œê°„ ì •ë³´ê°€ ìˆìœ¼ë©´ ë‚ ì§œ+ì‹œê°„ í˜•ì‹ìœ¼ë¡œ
                        event.start = `${startDateStr}T${schedule.startTime}:00`;
                        event.end = `${endDateStr}T${schedule.endTime}:00`;
                    } else {
                        // ì‹œê°„ ì •ë³´ê°€ ì—†ìœ¼ë©´ ë‚ ì§œë§Œ (ì¢…ì¼ ì´ë²¤íŠ¸)
                        event.start = startDateStr;
                        // FullCalendarëŠ” ì¢…ì¼ ì´ë²¤íŠ¸ì˜ ì¢…ë£Œì¼ì„ exclusiveë¡œ ì²˜ë¦¬í•˜ë¯€ë¡œ +1ì¼
                        const endDate = new Date(endDateStr);
                        endDate.setDate(endDate.getDate() + 1);
                        event.end = endDate.toISOString().split('T')[0];
                    }

                    return event;
                });

                return events;
            } catch (error) {
                console.error('ì „ì‚¬ ì¼ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                return [];
            }
        }

        // í•„í„° ë³€ê²½ ì‹œ ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨
        function refreshCompanyCalendar() {
            if (companyCalendar && selectedScheduleCard === 'company') {
                companyCalendar.refetchEvents();
            }
        }

        // ì¼ì • ëª©ë¡ ë¡œë“œ
        async function loadSchedules() {
            try {
                const response = await fetch('/api/intranet/schedules');

                if (!response.ok) {
                    console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', response.status);
                    allSchedules = [];
                    displayScheduleTable([]);
                    return;
                }

                const data = await response.json();

                // API ì‘ë‹µì´ ë°°ì—´ì¸ ê²½ìš°ì™€ ê°ì²´ì¸ ê²½ìš° ëª¨ë‘ ì²˜ë¦¬
                if (Array.isArray(data)) {
                    allSchedules = data;
                } else if (data.success && data.schedules) {
                    allSchedules = data.schedules;
                } else if (data.schedules) {
                    allSchedules = data.schedules;
                } else {
                    allSchedules = [];
                }

                console.log('ì „ì²´ ì¼ì • ê°œìˆ˜:', allSchedules.length);

                // íœ´ê°€/ë°˜ì°¨/ì¶œì¥ íƒ€ì…ë§Œ í•„í„°ë§
                allSchedules = allSchedules.filter(s => {
                    const type = s.scheduleType;
                    return type === 'VACATION' || type === 'HALF_DAY' || type === 'BUSINESS_TRIP';
                });

                displayScheduleTable(allSchedules);
            } catch (error) {
                console.error('ì¼ì • ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
                allSchedules = [];
                document.getElementById('scheduleTableContent').innerHTML = `
                    <div class="empty-state">
                        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        async function updateScheduleStats() {
            try {
                // ì „ì‚¬ ì¼ì • ì¹´ë“œ - ê¸ˆì¼ ì¼ì • ê°œìˆ˜ (APPROVED ë˜ëŠ” RESERVEDë§Œ)
                const today = new Date();
                const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

                const todayScheduleCount = allSchedules.filter(s => {
                    // APPROVED ë˜ëŠ” RESERVED ìƒíƒœë§Œ
                    if (s.status !== 'APPROVED' && s.status !== 'RESERVED') return false;

                    // ë‚ ì§œ í˜•ì‹ ì •ê·œí™”
                    const startDateStr = s.startDate ? s.startDate.split('T')[0] : '';
                    const endDateStr = s.endDate ? s.endDate.split('T')[0] : '';

                    // ê¸ˆì¼ì´ ì¼ì • ê¸°ê°„ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
                    return todayStr >= startDateStr && todayStr <= endDateStr;
                }).length;

                document.getElementById('companyScheduleCount').textContent = `${todayScheduleCount}`;

                // ì„ì§ì› ì—°ì°¨ í˜„í™© ì¹´ë“œ - í™œì„± êµ¬ì„±ì› ìˆ˜
                const membersResponse = await fetch('/api/intranet/members');
                if (membersResponse.ok) {
                    const membersData = await membersResponse.json();
                    const members = membersData.members || membersData || [];
                    const activeMemberCount = members.filter(m => m.isActive).length;
                    document.getElementById('annualLeaveCount').textContent = activeMemberCount;
                }

                // íœ´ê°€ ìŠ¹ì¸ ëª©ë¡ ì¹´ë“œ - ìŠ¹ì¸ëœ íœ´ê°€ ê°œìˆ˜
                const approvedCount = allSchedules.filter(s =>
                    (s.status === 'APPROVED' || s.approvalStatus === 'APPROVED')
                ).length;
                document.getElementById('approvalLeaveCount').textContent = approvedCount;
            } catch (error) {
                console.error('í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ì¼ì • í…Œì´ë¸” í‘œì‹œ
        function displayScheduleTable(schedules) {
            const container = document.getElementById('scheduleTableContent');

            if (!schedules || schedules.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>í‘œì‹œí•  ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            };

            // ìœ í˜• í•œê¸€ëª… ë§¤í•‘
            const typeLabels = {
                'VACATION': 'ì—°ì°¨',
                'HALF_DAY': 'ë°˜ì°¨',
                'BUSINESS_TRIP': 'ì¶œì¥'
            };

            // ìƒíƒœ í•œê¸€ëª… ë° ìŠ¤íƒ€ì¼ ë§¤í•‘
            const statusLabels = {
                'PENDING': 'ìŠ¹ì¸ ëŒ€ê¸°',
                'APPROVED': 'ìŠ¹ì¸ë¨',
                'REJECTED': 'ë°˜ë ¤ë¨'
            };

            const statusStyles = {
                'PENDING': 'color: #f59e0b; font-weight: 600;',
                'APPROVED': 'color: #10b981; font-weight: 600;',
                'REJECTED': 'color: #ef4444; font-weight: 600;'
            };

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ì‹ ì²­ì</th>
                            <th>ë¶€ì„œ</th>
                            <th>ìœ í˜•</th>
                            <th>ì‹œì‘ì¼</th>
                            <th>ì¢…ë£Œì¼</th>
                            <th>ìƒíƒœ</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${schedules.map(schedule => {
                            const typeName = typeLabels[schedule.scheduleType] || schedule.scheduleType;
                            const status = schedule.status || schedule.approvalStatus || 'UNKNOWN';
                            const statusLabel = statusLabels[status] || status;
                            const statusStyle = statusStyles[status] || '';

                            return `
                                <tr>
                                    <td>${schedule.id}</td>
                                    <td><strong>${schedule.memberName || schedule.userName || '-'}</strong></td>
                                    <td>${schedule.departmentName || '-'}</td>
                                    <td><span style="padding: 4px 8px; background: #f3f4f6; border-radius: 4px; font-size: 12px;">${typeName}</span></td>
                                    <td>${formatDate(schedule.startDate)}</td>
                                    <td>${formatDate(schedule.endDate)}</td>
                                    <td><span style="${statusStyle}">${statusLabel}</span></td>
                                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${schedule.description || '-'}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        // êµ¬ì„±ì› ëª©ë¡ ë¡œë“œ (ì¼ì • íƒ­ìš©)
        async function loadScheduleMembersByDept(parentDeptId, childDeptId) {
            try {
                const response = await fetch('/api/intranet/members');
                if (!response.ok) return;

                const data = await response.json();
                const members = data.members || data || [];

                const memberSelect = document.getElementById('scheduleFilterMember');
                memberSelect.innerHTML = '<option value="">ì „ì²´ êµ¬ì„±ì›</option>';

                // ë¶€ì„œë³„ë¡œ êµ¬ì„±ì› í•„í„°ë§
                let filteredMembers = members.filter(m => m.isActive);

                if (childDeptId) {
                    // ë¶€ì„œê°€ ì„ íƒëœ ê²½ìš°
                    filteredMembers = filteredMembers.filter(m => String(m.departmentId) === String(childDeptId));
                } else if (parentDeptId) {
                    // ë³¸ë¶€ë§Œ ì„ íƒëœ ê²½ìš° - ë³¸ë¶€ì— ì†í•œ ëª¨ë“  ë¶€ì„œì˜ êµ¬ì„±ì›
                    const childDepts = scheduleDepartments.filter(d => String(d.parentId) === String(parentDeptId));
                    const childDeptIds = childDepts.map(d => String(d.id));
                    filteredMembers = filteredMembers.filter(m => childDeptIds.includes(String(m.departmentId)));
                }

                filteredMembers.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.name} (${member.position || ''})`;
                    memberSelect.appendChild(option);
                });
            } catch (error) {
                console.error('êµ¬ì„±ì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì—°ì°¨ í˜„í™© í…Œì´ë¸” ë¡œë“œ
        async function loadAnnualLeaveTable() {
            const tableContent = document.getElementById('scheduleTableContent');
            tableContent.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 16px;">ë¡œë”© ì¤‘...</p>
                </div>
            `;

            try {
                // êµ¬ì„±ì› ë° ì¼ì • ë°ì´í„° ë³‘ë ¬ ë¡œë“œ
                const [membersResponse, schedulesResponse] = await Promise.all([
                    fetch('/api/intranet/members'),
                    fetch('/api/intranet/schedules')
                ]);

                if (!membersResponse.ok || !schedulesResponse.ok) {
                    throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const membersData = await membersResponse.json();
                const schedulesData = await schedulesResponse.json();

                const members = membersData.members || membersData || [];
                const schedules = Array.isArray(schedulesData) ? schedulesData : (schedulesData.schedules || []);

                // í™œì„± êµ¬ì„±ì›ë§Œ í•„í„°ë§
                let activeMembers = members.filter(m => m.isActive);

                // í•„í„° ì ìš©
                const typeFilter = document.getElementById('scheduleTypeFilter')?.value || '';
                const parentDept = document.getElementById('scheduleFilterParentDept')?.value || '';
                const childDept = document.getElementById('scheduleFilterChildDept')?.value || '';
                const memberId = document.getElementById('scheduleFilterMember')?.value || '';

                // ë¶€ì„œ í•„í„° ì ìš©
                if (childDept) {
                    activeMembers = activeMembers.filter(m => String(m.departmentId) === String(childDept));
                } else if (parentDept) {
                    const childDepts = scheduleDepartments.filter(d => String(d.parentId) === String(parentDept));
                    const childDeptIds = childDepts.map(d => String(d.id));
                    activeMembers = activeMembers.filter(m => childDeptIds.includes(String(m.departmentId)));
                }

                // êµ¬ì„±ì› í•„í„° ì ìš©
                if (memberId) {
                    activeMembers = activeMembers.filter(m => String(m.id) === String(memberId));
                }

                // ê° êµ¬ì„±ì›ë³„ ì—°ì°¨ ê³„ì‚°
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const tableData = activeMembers.map(member => {
                    // í•´ë‹¹ êµ¬ì„±ì›ì˜ ìŠ¹ì¸ëœ ì—°ì°¨/ë°˜ì°¨/ì¶œì¥ ì¼ì •
                    const memberSchedules = schedules.filter(s =>
                        String(s.memberId) === String(member.id) &&
                        (s.status === 'APPROVED' || s.approvalStatus === 'APPROVED') &&
                        (s.scheduleType === 'VACATION' || s.scheduleType === 'HALF_DAY' || s.scheduleType === 'BUSINESS_TRIP')
                    );

                    // ìœ í˜• í•„í„° ì ìš©
                    let filteredSchedules = memberSchedules;
                    if (typeFilter) {
                        filteredSchedules = memberSchedules.filter(s => s.scheduleType === typeFilter);
                    }

                    // ì‚¬ìš© ì—°ì°¨ ê³„ì‚° (ì¢…ë£Œì¼ <= ì˜¤ëŠ˜)
                    const usedLeave = filteredSchedules.filter(s => {
                        const endDate = new Date(s.endDate);
                        endDate.setHours(0, 0, 0, 0);
                        return endDate <= today;
                    }).reduce((sum, s) => {
                        if (s.scheduleType === 'HALF_DAY') return sum + 0.5;
                        if (s.scheduleType === 'VACATION' || s.scheduleType === 'BUSINESS_TRIP') {
                            const start = new Date(s.startDate);
                            const end = new Date(s.endDate);
                            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                            return sum + days;
                        }
                        return sum;
                    }, 0);

                    // ì˜ˆì • ì—°ì°¨ ê³„ì‚° (ì‹œì‘ì¼ > ì˜¤ëŠ˜)
                    const scheduledLeave = filteredSchedules.filter(s => {
                        const startDate = new Date(s.startDate);
                        startDate.setHours(0, 0, 0, 0);
                        return startDate > today;
                    }).reduce((sum, s) => {
                        if (s.scheduleType === 'HALF_DAY') return sum + 0.5;
                        if (s.scheduleType === 'VACATION' || s.scheduleType === 'BUSINESS_TRIP') {
                            const start = new Date(s.startDate);
                            const end = new Date(s.endDate);
                            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                            return sum + days;
                        }
                        return sum;
                    }, 0);

                    // ë³´ìœ  ì—°ì°¨ (members_intranet.annual_leave_granted ì‚¬ìš©)
                    const totalLeave = member.annualLeaveGranted || 15;
                    const remainingLeave = totalLeave - usedLeave - scheduledLeave;

                    // ë¶€ì„œ ì •ë³´ ì°¾ê¸°
                    const dept = scheduleDepartments.find(d => String(d.id) === String(member.departmentId));
                    const parentDeptObj = dept ? scheduleDepartments.find(d => String(d.id) === String(dept.parentId)) : null;

                    return {
                        id: member.id,
                        division: parentDeptObj?.name || '-',
                        department: dept?.name || '-',
                        name: member.name,
                        position: member.position || '-',
                        totalLeave: totalLeave,
                        remainingLeave: remainingLeave,
                        usedLeave: usedLeave,
                        scheduledLeave: scheduledLeave
                    };
                });

                // í…Œì´ë¸” ë Œë”ë§
                displayAnnualLeaveTable(tableData);

                // ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById('annualLeaveCount').textContent = tableData.length;

            } catch (error) {
                console.error('ì—°ì°¨ í˜„í™© ë¡œë“œ ì‹¤íŒ¨:', error);
                tableContent.innerHTML = `
                    <div class="empty-state">
                        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // ì—°ì°¨ í˜„í™© í…Œì´ë¸” í‘œì‹œ
        function displayAnnualLeaveTable(data) {
            const tableContent = document.getElementById('scheduleTableContent');

            if (data.length === 0) {
                tableContent.innerHTML = `
                    <div class="empty-state">
                        <p>ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            tableContent.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ë³¸ë¶€</th>
                            <th>ë¶€ì„œ</th>
                            <th>ì´ë¦„</th>
                            <th>ì§ê¸‰</th>
                            <th>ë³´ìœ  ì—°ì°¨</th>
                            <th>ì”ì—¬ ì—°ì°¨</th>
                            <th>ì‚¬ìš© ì—°ì°¨</th>
                            <th>ì˜ˆì • ì—°ì°¨</th>
                            <th>ì´ë ¥ í™•ì¸</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(row => `
                            <tr>
                                <td>${row.division}</td>
                                <td>${row.department}</td>
                                <td>${row.name}</td>
                                <td>${row.position}</td>
                                <td><span class="leave-number leave-total">${row.totalLeave}</span>ì¼</td>
                                <td><span class="leave-number leave-remaining">${row.remainingLeave}</span>ì¼</td>
                                <td><span class="leave-number leave-used">${row.usedLeave}</span>ì¼</td>
                                <td><span class="leave-number leave-scheduled">${row.scheduledLeave}</span>ì¼</td>
                                <td><button class="btn-history" onclick="showLeaveHistory(${row.id}, '${row.name}')">í™•ì¸</button></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ì—°ì°¨ ì´ë ¥ íŒì—… ì—´ê¸°
        async function showLeaveHistory(memberId, memberName) {
            const modal = document.getElementById('leaveHistoryModal');
            const content = document.getElementById('leaveHistoryContent');

            modal.style.display = 'block';

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            content.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 16px;">ë¡œë”© ì¤‘...</p>
                </div>
            `;

            try {
                // í•´ë‹¹ êµ¬ì„±ì›ì˜ ì—°ì°¨ ì´ë ¥ ì¡°íšŒ
                const response = await fetch('/api/intranet/schedules');
                if (!response.ok) throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');

                const schedulesData = await response.json();
                const schedules = Array.isArray(schedulesData) ? schedulesData : (schedulesData.schedules || []);

                // í•´ë‹¹ êµ¬ì„±ì›ì˜ ì—°ì°¨/ë°˜ì°¨ë§Œ í•„í„°ë§ (APPROVED ìƒíƒœë§Œ)
                const memberLeaveHistory = schedules.filter(s =>
                    String(s.memberId) === String(memberId) &&
                    (s.status === 'APPROVED' || s.approvalStatus === 'APPROVED') &&
                    (s.scheduleType === 'VACATION' || s.scheduleType === 'HALF_DAY')
                ).sort((a, b) => new Date(b.startDate) - new Date(a.startDate)); // ìµœì‹ ìˆœ ì •ë ¬

                if (memberLeaveHistory.length === 0) {
                    content.innerHTML = `
                        <div class="history-empty">
                            <p style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">${memberName}ë‹˜</p>
                            <p>ì‚¬ìš©ëœ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                    return;
                }

                // ì‚¬ìš©ì¼ìˆ˜ ê³„ì‚°
                const historyWithDays = memberLeaveHistory.map(s => {
                    let daysUsed = 0;
                    if (s.scheduleType === 'HALF_DAY') {
                        daysUsed = 0.5;
                    } else if (s.scheduleType === 'VACATION') {
                        const start = new Date(s.startDate);
                        const end = new Date(s.endDate);
                        daysUsed = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                    }
                    return { ...s, daysUsed };
                });

                // ì´ ì‚¬ìš©ì¼ìˆ˜ ê³„ì‚°
                const totalDays = historyWithDays.reduce((sum, s) => sum + s.daysUsed, 0);

                // í…Œì´ë¸” ë Œë”ë§
                content.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ì‹œì‘ì¼</th>
                                <th>ì¢…ë£Œì¼</th>
                                <th>ì‚¬ìš©ì¼ìˆ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${historyWithDays.map(s => `
                                <tr>
                                    <td>${memberName}</td>
                                    <td>${s.startDate ? s.startDate.split('T')[0] : '-'}</td>
                                    <td>${s.endDate ? s.endDate.split('T')[0] : '-'}</td>
                                    <td>${s.daysUsed}ì¼</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="history-summary">
                        ì´ ì‚¬ìš©ì¼ìˆ˜: ${totalDays}ì¼
                    </div>
                `;

            } catch (error) {
                console.error('ì—°ì°¨ ì´ë ¥ ë¡œë“œ ì‹¤íŒ¨:', error);
                content.innerHTML = `
                    <div class="history-empty">
                        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // ì—°ì°¨ ì´ë ¥ íŒì—… ë‹«ê¸°
        function closeLeaveHistoryModal() {
            document.getElementById('leaveHistoryModal').style.display = 'none';
        }

        // í•„í„° ì ìš©
        // í•„í„° ë°ì´í„° (ìƒˆ êµ¬ì¡°ìš©)
        function filterScheduleData() {
            if (selectedScheduleCard === 'annual') {
                // ì„ì§ì› ì—°ì°¨ í˜„í™© ì¹´ë“œì¼ ë•Œë§Œ í…Œì´ë¸” í•„í„°ë§
                loadAnnualLeaveTable();
            } else if (selectedScheduleCard === 'company') {
                // ì „ì‚¬ ì¼ì • ì¹´ë“œì¼ ë•Œ ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨
                refreshCompanyCalendar();
            }
        }

        function filterSchedules() {
            const statusFilter = document.getElementById('scheduleStatusFilter')?.value || '';
            const typeFilter = document.getElementById('scheduleTypeFilter')?.value || '';
            const parentDept = document.getElementById('scheduleFilterParentDept')?.value || '';
            const childDept = document.getElementById('scheduleFilterChildDept')?.value || '';
            const searchTerm = document.getElementById('scheduleSearchInput')?.value.toLowerCase() || '';

            let filtered = [...allSchedules];

            // ìƒíƒœ í•„í„°
            if (statusFilter) {
                filtered = filtered.filter(s => (s.status || s.approvalStatus) === statusFilter);
            }

            // ìœ í˜• í•„í„°
            if (typeFilter) {
                filtered = filtered.filter(s => s.scheduleType === typeFilter);
            }

            // ë³¸ë¶€ í•„í„°
            if (parentDept && !childDept) {
                const childDepts = scheduleDepartments.filter(d => String(d.parentId) === String(parentDept));
                const childDeptIds = childDepts.map(d => d.id);
                filtered = filtered.filter(s => childDeptIds.includes(Number(s.departmentId)));
            }

            // ë¶€ì„œ í•„í„°
            if (childDept) {
                filtered = filtered.filter(s => String(s.departmentId) === String(childDept));
            }

            // ê²€ìƒ‰ì–´ í•„í„° (ì‹ ì²­ì ì´ë¦„)
            if (searchTerm) {
                filtered = filtered.filter(s => {
                    const memberName = (s.memberName || s.userName || '').toLowerCase();
                    return memberName.includes(searchTerm);
                });
            }

            displayScheduleTable(filtered);
        }

        // ë³¸ë¶€ ì„ íƒ ë³€ê²½ ì‹œ (ì¼ì • íƒ­)
        function onScheduleParentDeptChange() {
            const parentId = document.getElementById('scheduleFilterParentDept').value;
            const childSelect = document.getElementById('scheduleFilterChildDept');
            const memberSelect = document.getElementById('scheduleFilterMember');

            // ë¶€ì„œ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
            childSelect.innerHTML = '<option value="">ì „ì²´ ë¶€ì„œ</option>';
            childSelect.value = '';

            // êµ¬ì„±ì› ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
            memberSelect.innerHTML = '<option value="">ì „ì²´ êµ¬ì„±ì›</option>';
            memberSelect.value = '';

            if (parentId) {
                const childDepts = scheduleDepartments.filter(d => String(d.parentId) === String(parentId));
                childDepts.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.id;
                    option.textContent = dept.name;
                    childSelect.appendChild(option);
                });

                // ë³¸ë¶€ì— ì†í•œ êµ¬ì„±ì› ë¡œë“œ
                loadScheduleMembersByDept(parentId, null);
            }

            filterScheduleData();
        }

        // ë¶€ì„œ ì„ íƒ ë³€ê²½ ì‹œ (ì¼ì • íƒ­)
        function onScheduleChildDeptChange() {
            const parentId = document.getElementById('scheduleFilterParentDept').value;
            const childId = document.getElementById('scheduleFilterChildDept').value;
            const memberSelect = document.getElementById('scheduleFilterMember');

            // êµ¬ì„±ì› ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
            memberSelect.innerHTML = '<option value="">ì „ì²´ êµ¬ì„±ì›</option>';
            memberSelect.value = '';

            if (childId) {
                // ë¶€ì„œì— ì†í•œ êµ¬ì„±ì› ë¡œë“œ
                loadScheduleMembersByDept(parentId, childId);
            } else if (parentId) {
                // ë³¸ë¶€ì— ì†í•œ êµ¬ì„±ì› ë¡œë“œ
                loadScheduleMembersByDept(parentId, null);
            }

            filterScheduleData();
        }


        // ======================================
        // ê²½ë¹„ë³´ê³ ì„œ íƒ­ ê´€ë ¨ í•¨ìˆ˜
        // ======================================
        let calendar = null;

        // ê²½ë¹„ í†µê³„ ë¡œë“œ
        async function loadExpenseStats() {
            try {
                console.log('ê²½ë¹„ë³´ê³ ì„œ í†µê³„ ë¡œë“œ');
                // ê²½ë¹„ë³´ê³ ì„œ í†µê³„ API í˜¸ì¶œ (í•„ìš”ì‹œ ì¶”ê°€)
            } catch (error) {
                console.error('ê²½ë¹„ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ìº˜ë¦°ë” ì´ˆê¸°í™” (ê²½ë¹„ë³´ê³ ì„œìš© - schedule-calendar.htmlê³¼ ë™ì¼)
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (!calendarEl) {
                console.log('calendar ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek'
                },
                buttonText: {
                    today: 'ì˜¤ëŠ˜',
                    month: 'ì›”',
                    week: 'ì£¼'
                },
                height: 'auto',
                // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œëŠ” ì¡°íšŒ ì „ìš©
                selectable: false,
                editable: false,
                // ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ìƒì„¸ë³´ê¸°
                eventClick: function(info) {
                    alert(`ì¼ì •: ${info.event.title}\në‚ ì§œ: ${info.event.startStr}`);
                },
                // ì´ë²¤íŠ¸ ë§ˆìš°ìŠ¤ í˜¸ë²„ (íˆ´íŒ)
                eventMouseEnter: function(info) {
                    const event = info.event;
                    const tooltip = document.createElement('div');
                    tooltip.className = 'event-tooltip';
                    tooltip.id = `tooltip-${event.id}`;

                    const scheduleTypeLabels = {
                        'VACATION': 'ì—°ì°¨',
                        'HALF_DAY': 'ë°˜ì°¨',
                        'MEETING': 'íšŒì˜',
                        'BUSINESS_TRIP': 'ì¶œì¥'
                    };

                    const statusLabels = {
                        'DRAFT': 'ì´ˆì•ˆ',
                        'SUBMITTED': 'ê²°ì¬ ëŒ€ê¸°',
                        'PENDING': 'ê²°ì¬ ëŒ€ê¸°',
                        'APPROVED': 'ìŠ¹ì¸ë¨',
                        'REJECTED': 'ë°˜ë ¤',
                        'CANCELLED': 'ì·¨ì†Œ'
                    };

                    const scheduleType = scheduleTypeLabels[event.extendedProps.scheduleType] || event.extendedProps.scheduleType;
                    const statusText = statusLabels[event.extendedProps.status] || event.extendedProps.status;

                    tooltip.innerHTML = `
                        <div style="padding: 12px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 150px; max-width: 250px;">
                            <div style="font-size: 14px; font-weight: 700; color: #2d3748; margin-bottom: 4px;">${scheduleType}</div>
                            <div style="font-size: 13px; color: #718096; margin-bottom: 8px;">${event.extendedProps.userName || event.extendedProps.memberName || ''}</div>
                            <div style="font-size: 13px; color: #64748b; border-top: 1px solid #e2e8f0; padding-top: 8px;">
                                <strong>ìƒíƒœ:</strong> ${statusText}
                            </div>
                        </div>
                    `;

                    document.body.appendChild(tooltip);

                    const rect = info.el.getBoundingClientRect();
                    tooltip.style.position = 'fixed';
                    tooltip.style.left = rect.left + 'px';
                    tooltip.style.top = (rect.bottom + 5) + 'px';
                    tooltip.style.zIndex = '10000';
                },
                eventMouseLeave: function(info) {
                    const tooltip = document.getElementById(`tooltip-${info.event.id}`);
                    if (tooltip) {
                        tooltip.remove();
                    }
                },
                events: [],
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    meridiem: false,
                    hour12: false
                },
                displayEventTime: false,
                displayEventEnd: false
            });

            calendar.render();
        }

        window.addEventListener('load', async () => {
            displayUserInfo();
            loadAllNotifications();

            // ì²« ë²ˆì§¸ íƒ­(ì¼ì •/íœ´ê°€) ìë™ ë¡œë“œ
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ì¼ì • íƒ­ ì´ˆê¸°í™” ì‹œì‘');
            loadScheduleStats();
            await initScheduleTab();
        });
    </script>
</body>
</html>
