<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ync.intranet.mapper.AttachmentIntranetMapper">

    <resultMap id="AttachmentIntranetResultMap" type="com.ync.intranet.domain.AttachmentIntranet">
        <id property="id" column="id"/>
        <result property="documentId" column="document_id"/>
        <result property="fileName" column="file_name"/>
        <result property="filePath" column="file_path"/>
        <result property="fileSize" column="file_size"/>
        <result property="fileType" column="file_type"/>
        <result property="uploadedBy" column="uploaded_by"/>
        <result property="uploadedAt" column="uploaded_at"/>
    </resultMap>

    <!-- 첨부파일 등록 -->
    <insert id="insert" parameterType="com.ync.intranet.domain.AttachmentIntranet">
        <selectKey keyProperty="id" resultType="long" order="BEFORE">
            SELECT attachments_intranet_seq.NEXTVAL FROM dual
        </selectKey>
        INSERT INTO attachments_intranet (
            id, document_id, file_name, file_path,
            file_size, file_type, uploaded_by, uploaded_at
        )
        VALUES (
            #{id}, #{documentId}, #{fileName}, #{filePath},
            #{fileSize}, #{fileType}, #{uploadedBy}, CURRENT_TIMESTAMP
        )
    </insert>

    <!-- ID로 첨부파일 조회 -->
    <select id="findById" resultMap="AttachmentIntranetResultMap">
        SELECT *
        FROM attachments_intranet
        WHERE id = #{id}
    </select>

    <!-- 문서별 첨부파일 목록 조회 -->
    <select id="findByDocumentId" resultMap="AttachmentIntranetResultMap">
        SELECT *
        FROM attachments_intranet
        WHERE document_id = #{documentId}
        ORDER BY uploaded_at ASC
    </select>

    <!-- 첨부파일 삭제 -->
    <delete id="deleteById">
        DELETE FROM attachments_intranet
        WHERE id = #{id}
    </delete>

    <!-- 문서의 모든 첨부파일 삭제 -->
    <delete id="deleteByDocumentId">
        DELETE FROM attachments_intranet
        WHERE document_id = #{documentId}
    </delete>

</mapper>
